# =============================================================================
# ハッシュ関数の基本を学ぶ
#
# ハッシュ関数とは：任意の長さのデータを固定長の値（ダイジェスト）に変換する関数
# 用途：データの整合性確認、パスワード保存、デジタル署名の基盤
# =============================================================================

# OpenSSLモジュール
# - Rubyの標準ライブラリで、暗号技術全般（ハッシュ、暗号化、署名など）を提供
# - 内部ではC言語で書かれたOpenSSLライブラリを使用しており高速
require 'openssl'

puts "=== ハッシュ関数を試してみよう ==="
puts

message = "Hello, World!"
puts "元のメッセージ: #{message}"
puts

# =============================================================================
# SHA-256でハッシュ化
#
# SHA-256（Secure Hash Algorithm 256-bit）とは：
# - 米国NISTが標準化した暗号学的ハッシュ関数
# - どんな入力でも必ず256ビット（32バイト）の出力になる
# - 現在最も広く使われているハッシュ関数の一つ
#
# hexdigestメソッド：
# - ハッシュ値を16進数の文字列として返す
# - 256bit = 32バイト = 64文字の16進数（1バイト = 2文字の16進数）
# =============================================================================
hash = OpenSSL::Digest::SHA256.hexdigest(message)
puts "SHA-256ハッシュ: #{hash}"
puts "ハッシュの長さ: #{hash.length}文字 (256bit = 64文字の16進数)"
puts

# =============================================================================
# ハッシュ関数の特性1: 決定性（Deterministic）
#
# 同じ入力からは常に同じ出力が得られる
# → だからこそ、データの整合性確認に使える
# =============================================================================
puts "--- 同じメッセージ → 同じハッシュ ---"
hash2 = OpenSSL::Digest::SHA256.hexdigest(message)
puts "もう一度ハッシュ: #{hash2}"
puts "一致する？: #{hash == hash2}"
puts

# =============================================================================
# ハッシュ関数の特性2: 雪崩効果（Avalanche Effect）
#
# 入力が1ビットでも変わると、出力が大きく変化する
# → 改ざんがあれば即座に検出できる
# → 元のデータを推測することが困難になる
# =============================================================================
puts "--- 1文字変えると... ---"
modified = "Hello, World?" # ! を ? に変更（たった1文字！）
hash3 = OpenSSL::Digest::SHA256.hexdigest(modified)
puts "変更後メッセージ: #{modified}"
puts "変更後ハッシュ:   #{hash3}"
puts "全く違う！"
